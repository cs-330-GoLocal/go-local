cards = `[
  {
      "categories": ["restaurant", "food", "lunch", "american"],
      "name": "Board and Brew",
      "info": ["Lunch", "Sandwiches", "1212 Camino Del Mar #2506, Del Mar, CA 92014"],
      "images": ["images/Board-and-Brew.jpg", "images/Board-and-Brew-Food.jpg"]
  },
  {
      "categories":  ["restaurant", "food", "lunch", "dinner"],
      "name": "The Brigrantine",
      "info": ["Lunch and Dinner", "Seafood", "3263 Camino Del Mar, Del Mar, CA 92014"],
      "images": ["images/Brigantine.jpg", "images/The-Brig-Food.jpg"]
  },
  {
      "categories":  ["restaurant", "food", "breakfast", "lunch", "dinner", "american"],
      "name": "Americana",
      "info": ["Breakfast, Lunch and Dinner", "American cuisine", "1454 Camino Del Mar, Del Mar, CA 92014"],
      "images": ["images/Americana.jpg", "images/Americana-Food.jpeg"]
  },
  {
      "categories": ["restaurant", "food", "lunch", "dinner", "american"],
      "name": "Sbicca",
      "info": ["Lunch and Dinner", "American Bistro", "215 15th St, Del Mar, CA 92014"],
      "images": ["images/sbicca.jpg", "images/sbicca-food.jpg"]
  },
  {
      "categories": ["restaurant", "food", "breakfast", "lunch", "dinner", "mexican"],
      "name": "Roberto's Tacos",
      "info": ["Breakfast, Lunch and Dinner", "Mexican cuisine", "2206 Carmel Valley Rd #3704, Del Mar, CA 92014"],
      "images": ["images/robertos.jpg", "images/robertos-food.jpg"]
  },
  {
      "categories": ["restaurant", "food", "lunch", "dinner", "japanese"],
      "name": "Shimbashi",
      "info": ["Lunch and Dinner", "Japanese cuisine", "1555 Camino Del Mar #201"],
      "images": ["images/shimbashi.jpg", "images/shimbashi-food.jpg"]
  },

  {
      "categories":  ["activities", "outdoor", "active", "relaxing", "camping"],
      "name": "San Elijo State Beach",
      "info": ["2050 S Coast Hwy 101, Cardiff, CA 92007"],
      "images": ["images/San-Elijo-campground.jpeg"]
  },
  {
      "categories":  ["activities", "outdoor", "active", "relaxing", "camping"],
      "name": "Carlsbad State Beach",
      "info": ["7201 Carlsbad Blvd, Carlsbad, CA 92008"],
      "images": ["images/Carlsbad-campground.jpg"]
  },

  {
      "categories":  ["nightlife", "bars/clubs", "events", "music"],
      "name": "Jimmy O's",
      "info": ["Sports bar", "225 West 15th St, Del Mar, CA 92014"],
      "images": ["images/JimmyOs.jpg"]
  },
  {
      "categories":  ["nightlife", "bars/clubs", "events", "music"],
      "name": "Oggi's",
      "info": ["Casual sports bar", "12840 Carmel Country Rd, San Diego, CA 92130"],
      "images": ["images/Oggis.jpg"]
  },

  {
      "categories":  ["activities", "outdoor", "active", "relaxing", "beaches", "parks"],
      "name": "Powerhouse Park and Beach",
      "info": ["1658 Coast Blvd, Del Mar, CA 92014"],
      "images": ["images/Powerhouse-Park.jpg"]
  },
  {
      "categories":  ["activities", "outdoor", "active", "relaxing", "beaches"],
      "name": "Dog Beach",
      "info": ["3200 Camino Del Mar, Del Mar, CA 9201"],
      "images": ["images/dog-beach.jpg"]
  },

  {
      "categories":  ["activities", "sightseeing", "museums"],
      "name": "Free Flight Exotic Bird Sanctuary",
      "info": ["2132 Jimmy Durante Blvd, Del Mar, CA 9201"],
      "images": ["https://pbs.twimg.com/media/EIZnt-LWwAIZ9p4.jpg"]
  },
  {
      "categories":  ["activities", "sightseeing", "museums"],
      "name": "Lux Art Institute",
      "info": ["1550 S El Camino Real, Encinitas, CA 9202"],
      "images": ["https://yournorthcounty.com/wp-content/uploads/2014/03/Lux-Art-Institute-in-Encinitas1-1024x971.jpg"]
  },

  {
      "categories":  ["activities", "sightseeing", "landmarks", "nightlife", "bars/clubs", "family friendly"],
      "name": "Del Mar Plaza",
      "info": ["1555 Camino Del Mar, Del Mar, CA 92014"],
      "images": ["https://cdn.vox-cdn.com/thumbor/la5vX3VDVPKMx89TUbNNbnG5aT8=/0x0:1200x800/1820x1213/filters:focal(504x304:696x496)/cdn.vox-cdn.com/uploads/chorus_image/image/62701220/2.0.jpg"]
  },
  {
      "categories":  ["activities", "sightseeing", "landmarks", "outdoor", "active", "relaxing"],
      "name": "Torrey Pines Gliderport",
      "info": ["2800 Torrey Pines Scenic Dr, La Jolla, CA 92037"],
      "images": ["https://media.sandiegoreader.com/img/photos/2019/07/15/Torrey-Pines-Paraglider-CREDIT-SMJoness-iStock-GettyImages-908459366.jpg"]
  },
  {
      "categories":  ["activities", "sightseeing", "landmarks", "events", "music", "art", "shows"],
      "name": "Del Mar Fairgrounds",
      "info": ["2260 Jimmy Durante Blvd, Del Mar, CA 92014"],
      "images": ["https://guardtop.com/wp-content/uploads/2018/02/del-mar-fairgrounds.jpg"]
  },

  {
      "categories":  ["activities", "sightseeing", "events", "music", "shows"],
      "name": "Del Mar Racetrack",
      "info": ["Races July-September", "2260 Jimmy Durante Blvd, Del Mar, CA 92014"],
      "images": ["https://www.dmtc.com/data/assets/Static-Pages/DM-Gen/Del-Mar-Paddock.jpg"]
  },

  {
      "categories":  ["activities", "events", "music", "shows", "pop", "rock", "comedy", "outdoor", "active", "amusement parks"],
      "name": "Del Mar Fair",
      "info": ["Runs June 1 - July 4", "2260 Jimmy Durante Blvd, Del Mar, CA 92014"],
      "images": ["https://scrippsamg.com/wp-content/uploads/2017/06/shutterstock_214871359.jpg"]
  },

  {
      "categories":  ["events", "music", "shows", "festivals", "pop", "rock"],
      "name": "Kaboo",
      "info": ["Music Festival", "September", "2260 Jimmy Durante Blvd, Del Mar, CA 92014"],
      "images": ["https://ca-times.brightspotcdn.com/dims4/default/fd68b82/2147483647/strip/true/crop/2047x1151+0+0/resize/840x472!/quality/90/?url=https%3A%2F%2Fcalifornia-times-brightspot.s3.amazonaws.com%2F27%2F96%2F17298b71835740e4b962803b6ff3%2Fsd-1536109992-mxo5qo0bvf-snap-image"]
  }
]`

cardrs = JSON.parse(cards)

function createPosts(category,photourl,location,description) {
    if(photourl === ""){
        photourl = "images/GoLocal-logo.jpeg";
    }

    if(category === ""){
        category = "Blank"
    }

    var newCategory = true;
    var categories = document.querySelectorAll(".drummy > .category");

    for(item of categories) {
        if(item.id === category) {
            newCategory = false;
        }
    }

    if(newCategory){
        var template = `
        <div class ="category" id = "${category}">
            <h1>${category}</h1>
            <div class = "cat-content">
                <div class = "postcard">
                    <button class="prfbtn favbtn ptr" style="z-index:3;"><i class = "fa fa-star"></i></button>
                    <div class = "postimg">
                        <img src="${photourl}" alt="${location} Picture">
                    </div>
                    <h2>${location}</h2>
                    <h4>${description}</h4>
                </div>
            </div>
        </div>
        `;
        document.querySelector(".drummy").innerHTML += template;
    }
    else {
        var template = `
                <div class = "postcard zmi">
                    <button class="favbtn prfbtn ptr" style="z-index:3;"><i class = "fa fa-star"></i></button>
                    <div class = "postimg">
                        <img src="${photourl}" alt="${location} Picture">
                    </div>
                    <h2>${location}</h2>
                    <h4>${description}</h4>
                </div>
            `;
        document.querySelector(".drummy > #" + category + " > .cat-content").innerHTML += template;
    }
}

function filter() {
  let listOfFilters = [];

  let b = document.querySelectorAll(".tag");
  for (elem of b) {
    listOfFilters.push(elem.innerText.substring(0,elem.innerText.indexOf(" ×")).toLowerCase());
  }

  if(listOfFilters.length == 0) {
    document.querySelector(".cats").style = "";
    document.querySelector(".drummy").style = "display:none;";
  }
  else {
    document.querySelector(".cats").style = "display:none;";
    document.querySelector(".drummy").style = "";
    for (cat of document.querySelectorAll(".drummy > .category")) {
      cat.parentNode.removeChild(cat);
    }
  
    for(filterx of listOfFilters){
      for(card of cardrs) {
        if(card.categories.includes(filterx)) {
          description = card.info.join("\n");
          createPosts(filterx,card["images"][0],card["name"],description);
        }
      }
    }

    for(card of document.querySelectorAll(".drummy .postcard")) {
      console.log("hello");
      card.addEventListener("click",function(ev) {
          a = ev.currentTarget.querySelectorAll("h2,h3,h4");
          b = ev.currentTarget.querySelectorAll("img");
          c = 27;
          d = 2;
          e = Math.ceil((c/(c+d))*100);
          texts = ``;
          images = ``;
          for(text of a) {
              texts+=text.outerHTML;
          }
          for(image of b) {
              images += image.outerHTML;
          }
          if(ev.target.classList.contains("fa") || ev.target.classList.contains("favbtn")) {
              return;
          }
          makeModal(texts,images,e,c,d);
      });
    }

    for(fav of document.querySelectorAll(".drummy .favbtn")) {
      
    }
  }
}

let textvalue;
const Tags = () =>{
    const submit_button = document.getElementById('filter-submit');
    console.log(submit_button);
    submit_button.onclick = addTag(textvalue);
}
const addTag = (text) => {
    let template = `<a class="tag">${text} <span class="remove-icon"> × </span></a>`
    let element = document.getElementById('alltags');
    element.innerHTML += template;
    const remove_icons = document.querySelectorAll(".remove-icon");
    for(icon of remove_icons){
        icon.addEventListener("click", function(ev){
            ev.currentTarget.parentElement.parentElement.removeChild(ev.currentTarget.parentElement);
            filter();
        })
    }
}

function autocomplete(inp, arr) {
  /*the autocomplete function takes two arguments,
  the text field element and an array of possible autocompleted values:*/
  var currentFocus;
  /*execute a function when someone writes in the text field:*/
  inp.addEventListener("input", function(e) {
      var a, b, i, val = this.value;
      /*close any already open lists of autocompleted values*/
      closeAllLists();
      if (!val) { return false;}
      currentFocus = -1;
      /*create a DIV element that will contain the items (values):*/
      a = document.createElement("DIV");
      a.setAttribute("id", this.id + "autocomplete-list");
      a.setAttribute("class", "autocomplete-items");
      /*append the DIV element as a child of the autocomplete container:*/
      this.parentNode.appendChild(a);
      /*for each item in the array...*/
      for (i = 0; i < arr.length; i++) {
        /*check if the item starts with the same letters as the text field value:*/
        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
          /*create a DIV element for each matching element:*/
          b = document.createElement("DIV");
          /*make the matching letters bold:*/
          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
          b.innerHTML += arr[i].substr(val.length);
          /*insert a input field that will hold the current array item's value:*/
          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
          /*execute a function when someone clicks on the item value (DIV element):*/
          b.addEventListener("click", function(e) {
              /*insert the value for the autocomplete text field:*/
              inp.value = this.getElementsByTagName("input")[0].value;
              textvalue = inp.value;
              console.log(textvalue);
              Tags();
              inp.value = '';
              /*close the list of autocompleted values,
              (or any other open lists of autocompleted values:*/
              closeAllLists();
              filter();
          });
          a.appendChild(b);
        }
      }
  });
  /*execute a function presses a key on the keyboard:*/
  inp.addEventListener("keydown", function(e) {
      var x = document.getElementById(this.id + "autocomplete-list");
      if (x) x = x.getElementsByTagName("div");
      if (e.keyCode == 40) {
        /*If the arrow DOWN key is pressed,
        increase the currentFocus variable:*/
        currentFocus++;
        /*and and make the current item more visible:*/
        addActive(x);
      } else if (e.keyCode == 38) { //up
        /*If the arrow UP key is pressed,
        decrease the currentFocus variable:*/
        currentFocus--;
        /*and and make the current item more visible:*/
        addActive(x);
      } else if (e.keyCode == 13) {
        /*If the ENTER key is pressed, prevent the form from being submitted,*/
        e.preventDefault();
        if (currentFocus > -1) {
          /*and simulate a click on the "active" item:*/
          if (x) x[currentFocus].click();
        }
        else if (currentFocus == -1){
          currentFocus++;
          if (x) x[currentFocus].click();
        }
      }
  });

  
  function addActive(x) {
    /*a function to classify an item as "active":*/
    if (!x) return false;
    /*start by removing the "active" class on all items:*/
    removeActive(x);
    if (currentFocus >= x.length) currentFocus = 0;
    if (currentFocus < 0) currentFocus = (x.length - 1);
    /*add class "autocomplete-active":*/
    x[currentFocus].classList.add("autocomplete-active");
  }
  function removeActive(x) {
    /*a function to remove the "active" class from all autocomplete items:*/
    for (var i = 0; i < x.length; i++) {
      x[i].classList.remove("autocomplete-active");
    }
  }
  function closeAllLists(elmnt) {
    /*close all autocomplete lists in the document,
    except the one passed as an argument:*/
    var x = document.getElementsByClassName("autocomplete-items");
    for (var i = 0; i < x.length; i++) {
      if (elmnt != x[i] && elmnt != inp) {
        x[i].parentNode.removeChild(x[i]);
      }
    }
  }
  /*execute a function when someone clicks in the document:*/
  document.addEventListener("click", function (e) {
      closeAllLists(e.target);
  })
  Tags();
}

let everything = ["Food", "Breakfast", "Lunch", "Dinner", "Japanese", "American",
"Mexican", "Sightseeing", "Activities", "Museums", "Landmarks", "Tours", "Outdoor", "Active", 
"Amusement Parks", "Camping", "Hiking", "Water Activities", "Parks", "Rock Climbing", "Relaxing",
 "Beaches", "Parks", "Fishing", "Nightlife", "Bars/Clubs", "Family Friendly", "Comedy", "Events", 
 "Music", "Jazz", "Rock", "Pop", "Art", "Shows", "Festivals", "Theatre", "Dance", "Comedy", "Restaurant"];

autocomplete(document.getElementById("myInput"), everything);

const tagbar = document.getElementById("alltags");
const unde = tagbar.firstElementChild;
unde.remove();
